tosca_definitions_version: tosca_simple_yaml_1_0_0_wd03
description: A simple topology with a Mesos master and a Mesos slave on a standalone docker container
template_name: mesos-cluster-oneslave-docker
template_version: 1.0.0-SNAPSHOT
template_author: AFE

imports:
  - docker-provider-types:*
  - mesos-types:0.2.0-SNAPSHOT

topology_template:

  node_templates:

    container1:
      type: com.toscaruntime.docker.nodes.Container
      properties:
        image_id: toscaruntime/ubuntu-trusty
        exposed_ports:
          - port: 5050
        port_mappings:
          - from: 5050
            to: 5050
      capabilities:
        os:
          properties:
            distribution: ubuntu
            version: 14.04

    container2:
      type: com.toscaruntime.docker.nodes.Container
      properties:
        image_id: toscaruntime/ubuntu-trusty
        exposed_ports:
          - port: 5051
        port_mappings:
          - from: 5051
            to: 5051
      capabilities:
        os:
          properties:
            distribution: ubuntu
            version: 14.04

    base1:
      type: alien.nodes.MesosBase
      properties:
        version: 0.27.2-2.0.15
      requirements:
        - host: container1

    base2:
      type: alien.nodes.MesosBase
      properties:
        version: 0.27.2-2.0.15
      requirements:
        - host: container2

    master:
      type: alien.nodes.MesosMaster
      properties:
        cluster_name: "Simple TOSCA Mesos SA topology"
        log_dir: "/var/log/mesos/"
      requirements:
        - host: base1

    slave:
      type: alien.nodes.MesosSlave
      properties:
        log_dir: "/var/log/mesos/"
      requirements:
        - host: base2
        - master:
            node: master
            capability: alien.capabilities.MesosMaster

  outputs:
    mesos_url:
      description: The URL to access Mesos
      value: { get_attribute: [master, external_url] }
